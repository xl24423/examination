!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).StorageTiming={})}(this,function(t){"use strict";var o="StorageTiming",r="STORAGE_TIMING",s="localStorage",a="1.0.0";function i(t){return"number"==typeof t||"[object Number]"===Object.prototype.toString.call(t)}function u(t){return"string"==typeof t||"[object String]"===Object.prototype.toString.call(t)}function n(t){return void 0===t}e.compress=function(t){return{k:t.key,v:t.value,cr:t.createAt,up:t.updateAt,t:t.timeout}},e.decompression=function(t){return{key:t.k,value:t.v,createAt:t.cr,updateAt:t.up,timeout:t.t}},e.isForever=function(t){return-1===t},e.isTimeout=function(t){return!e.isForever(t)&&Date.now()>t},e.StorageModalMiniCheck=function(t){return"[object Object]"===Object.prototype.toString.call(t)&&(!!u(t.version)&&(!!Array.isArray(t.atoms)&&t.atoms.some(function(t){var e=u(t.k)||i(t.k),o=i(t.cr),n=i(t.up),t=i(t.t);return e&&o&&n&&t})))};var c=e;function e(){}var p=function(){return(p=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},h=(l.prototype.set=function(t){n(t)||this.storage.setItem(this.storageKey,JSON.stringify(t))},l.prototype.get=function(){try{return JSON.parse(this.storage.getItem(this.storageKey)||"null")}catch(t){return console.error(t),console.warn('The "'.concat(this.type,'" model of key "').concat(this.storageKey,'" is corrupt and cannot be resolved using JSON. Use null instead.')),null}},l.prototype.clear=function(){this.storage.removeItem(this.storageKey)},l.uniqueStorageKey=[],l);function l(t){var t=void 0===t?{}:t,e=t.storageKey,e=void 0===e?r:e,t=t.type,t=void 0===t?s:t;if(l.uniqueStorageKey.includes(e))throw new Error("".concat(o,': Storagekey "').concat(e,'" has been used. An "engineOptions.storageKye" the same storage can only be instantiated once. Please try using a different storageKey.'));l.uniqueStorageKey.push(e),this.storageKey=e,this.storage=window[t],this.type=t}y.prototype.getMeta=function(){return this.st.findAtom(this.key)},y.prototype.get=function(t){var t=n(t)?null:t,e=this.st.findAtom(this.key);return"[object Null]"===Object.prototype.toString.call(e)||c.isTimeout(e.timeout)?t:e.value},y.prototype.set=function(t,e){this.st.setAtom(this.key,t,e)},y.prototype.remove=function(){this.st.removeAtom(this.key)};var m=y;function y(t){var e=t.st,t=t.key;this.st=e,this.key=t}d.prototype.initModal=function(t){return c.StorageModalMiniCheck(t)?{version:t.version,atoms:t.atoms.map(function(t){return c.decompression(t)})}:{version:this.version,atoms:[]}},d.prototype.versionCheck=function(){var t,e,o;this.version!==this.modal.version&&(e=this.modal.version,this.modal.version=this.version,o=[],null!=(t=this.onVersionChange)&&t.call(this,this.getAtoms(),function(e){var t=o.findIndex(function(t){return t.key===e.key});-1===t?o.push(e):o.splice(t,1,e)},e),this.modal.atoms=o,this.save())},d.prototype.save=function(){this.engine.set({version:this.version,atoms:this.modal.atoms.map(c.compress)})},d.prototype.index=function(e){return this.modal.atoms.findIndex(function(t){return t.key===e})},d.prototype.findAtom=function(t){t=this.index(t);return-1===t?null:p({},this.modal.atoms[t])},d.prototype.setAtom=function(t,e,o){void 0===o&&(o=-1);var n,i=this.index(t),r=Date.now();-1===i?this.modal.atoms.push({key:t,value:e,createAt:r,updateAt:r,timeout:o}):(n=this.modal.atoms[i],this.modal.atoms.splice(i,1,{key:t,value:e,createAt:n.createAt,updateAt:r,timeout:o})),this.save()},d.prototype.removeAtom=function(t){t=this.index(t);-1!==t&&(this.modal.atoms.splice(t,1),this.save())},d.prototype.atom=function(t){return new m({st:this,key:t})},d.prototype.getAtoms=function(){return this.modal.atoms.map(function(t){return p({},t)})},d.prototype.clear=function(){this.modal.atoms=[],this.engine.clear()},d.prototype.clearTimeout=function(){this.modal.atoms=this.modal.atoms.filter(function(t){return!c.isTimeout(t.timeout)}),this.save()},d.prototype.info=function(){return{storageKey:this.storageKey,version:this.version}};var f=d;function d(t){var t=void 0===t?{}:t,e=t.version,o=t.storageKey,o=void 0===o?r:o,n=t.type,n=void 0===n?s:n,i=t.onVersionChange,t=t.clearTimeout,t=void 0!==t&&t;this.version=void 0===e?a:e,this.storageKey=o,this.engine=new h({storageKey:o,type:n}),this.modal=this.initModal(this.engine.get()),t&&this.clearTimeout(),this.onVersionChange=i,this.versionCheck()}t.DV_STORAGE_KEY=r,t.DV_STORAGE_TYPE=s,t.DV_STORAGE_VERSION=a,t.ModalUtils=c,t.NEVER_TIME_OUT=-1,t.PROJECT_NAME=o,t.Store=f,Object.defineProperty(t,"__esModule",{value:!0})});
